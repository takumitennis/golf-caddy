<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Golf Dashboard</title>
  <style>
    :root {
      --primary-color: #2f8f2f;
      --primary-dark: #1e5f1e;
      --primary-light: #4caf50;
      --secondary-color: #ffffff;
      --accent-color: #ff6b35;
      --text-color: #333333;
      --text-light: #666666;
      --bg-light: #f8f9fa;
      --bg-dark: #2c3e50;
      --border-radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.15);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Helvetica Neue", Arial, "Hiragino Sans", "Yu Gothic", "Meiryo", sans-serif;
      background: var(--bg-light);
      color: var(--text-color);
      line-height: 1.6;
    }

    /* Header */
    h1 {
      margin: 0;
      padding: 1.5rem 2rem;
      background: linear-gradient(135deg, var(--bg-dark), #34495e);
      color: #fff;
      font-size: 1.6rem;
      font-weight: 600;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    h1::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
    }

    /* Main Navigation */
    .tabs-main {
      display: flex;
      gap: 0.5rem;
      padding: 0 2rem;
      background: #ecf0f1;
      border-bottom: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .tabs-main button {
      background: #ecf0f1;
      border: none;
      padding: 1rem 1.5rem;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
      color: var(--text-light);
      position: relative;
      overflow: hidden;
    }

    .tabs-main button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .tabs-main button:hover::before {
      left: 100%;
    }

    .tabs-main button.active {
      border-color: var(--primary-color);
      background: #fff;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      color: var(--primary-color);
      font-weight: bold;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }

    .tabs-main button:hover {
      background: #fff;
      transform: translateY(-1px);
    }

    #logoutBtn {
      margin-left: auto;
      background: #e74c3c;
      color: white;
      border-radius: var(--border-radius);
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      transition: var(--transition);
    }

    #logoutBtn:hover {
      background: #c0392b;
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    /* Container */
    .container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Welcome Message */
    #welcome {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      padding: 1.5rem 2rem;
      border-radius: var(--border-radius);
      margin: 1rem 2rem;
      box-shadow: var(--shadow);
      text-align: center;
      font-size: 1.1rem;
      font-weight: 500;
    }

    /* Tab Content */
    .hidden {
      display: none;
    }

    /* Sub Tabs */
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .tabs button {
      padding: 0.75rem 1.5rem;
      margin-right: 0.5rem;
      border: none;
      border-bottom: 2px solid transparent;
      background: #f8f9fa;
      cursor: pointer;
      transition: var(--transition);
      border-radius: var(--border-radius);
      font-weight: 500;
      color: var(--text-light);
    }

    .tabs button.active {
      border-bottom-color: var(--primary-color);
      background: var(--primary-color);
      color: white;
      box-shadow: var(--shadow);
    }

    .tabs button:hover {
      background: var(--primary-light);
      color: white;
      transform: translateY(-1px);
    }

    /* Forms */
    form {
      background: #fff;
      padding: 2rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      border: 1px solid rgba(0,0,0,0.05);
    }

    form label {
      display: inline-block;
      margin-right: 1rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-color);
    }

    form input {
      padding: 0.75rem 1rem;
      margin-right: 1rem;
      border: 2px solid #e1e8ed;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    form input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(47, 143, 47, 0.1);
    }

    form button {
      padding: 0.75rem 1.5rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    form button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    /* Tables */
    table {
      background: #fff;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }

    th, td {
      border: 1px solid #e1e8ed;
      padding: 1rem;
      text-align: center;
      transition: var(--transition);
    }

    th {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    tr:hover {
      background: #f8f9fa;
    }

    /* Calendar */
    .calendar {
      background: #fff;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .calendar th, .calendar td {
      width: 14%;
      padding: 1rem 0.5rem;
      text-align: center;
      border: 1px solid #e1e8ed;
      transition: var(--transition);
    }

    .calendar th {
      background: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    .cal-green {
      background: #d4edda;
      color: #155724;
      font-weight: 600;
    }

    .cal-yellow {
      background: #fff3cd;
      color: #856404;
      font-weight: 600;
    }

    .cal-red {
      background: #f8d7da;
      color: #721c24;
      font-weight: 600;
    }

    .cal-blue {
      background: #cce5ff;
      color: #004085;
      font-weight: 600;
    }

    /* Calendar Navigation */
    .calendar-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      background: #fff;
      padding: 1rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .calendar-nav button {
      padding: 0.5rem 1rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
    }

    .calendar-nav button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .calendar-nav span {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-color);
    }

    /* Status Indicators */
    .status-indicator {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-active {
      background: #d4edda;
      color: #155724;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-completed {
      background: #cce5ff;
      color: #004085;
    }

    /* Cards */
    .card {
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(0,0,0,0.05);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    .card h3 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.3rem;
      font-weight: 600;
    }

    /* Messages */
    .message-item {
      background: #f8f9fa;
      border-radius: var(--border-radius);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary-color);
      transition: var(--transition);
    }

    .message-item:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .message-sender {
      font-weight: 600;
      color: var(--primary-color);
    }

    .message-date {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .message-content {
      color: var(--text-color);
      line-height: 1.5;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .tabs-main {
        flex-direction: column;
        padding: 1rem;
      }

      .tabs-main button {
        width: 100%;
        text-align: center;
        border-radius: var(--border-radius);
        margin-bottom: 0.5rem;
      }

      .tabs-main button.active {
        border-radius: var(--border-radius);
      }

      .tabs {
        flex-direction: column;
        gap: 0.5rem;
      }

      .tabs button {
        width: 100%;
        margin-right: 0;
      }

      form {
        padding: 1.5rem;
      }

      form label {
        display: block;
        margin-bottom: 0.5rem;
      }

      form input {
        width: 100%;
        margin-bottom: 1rem;
        margin-right: 0;
      }

      .calendar-nav {
        flex-direction: column;
        gap: 0.5rem;
      }

      .calendar th, .calendar td {
        padding: 0.5rem 0.25rem;
        font-size: 0.9rem;
      }

      table {
        font-size: 0.9rem;
      }

      th, td {
        padding: 0.75rem 0.5rem;
      }
    }

    /* Loading Animation */
    .loading {
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
    }

    .loading.loaded {
      opacity: 1;
      transform: translateY(0);
    }

    /* Success/Error Messages */
    .message {
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .message.info {
      background: #cce5ff;
      color: #004085;
      border: 1px solid #b8daff;
    }
  </style>
</head>
<body>
  <h1>ğŸŒï¸ ã‚´ãƒ«ãƒ•å ´ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
  <div class="tabs-main">
    <button id="btnMainProf">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
    <button id="btnMainStat" class="active">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</button>
    <button id="btnMainMsg">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
    <button id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>
  <div id="welcome" class="loading"></div>
  
  <!-- Profile Tab -->
  <div id="mainProfile" class="hidden container">
    <div class="card loading">
      <h3>ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h3>
      <div id="profileContent"></div>
    </div>
  </div>
  
  <!-- Status Tab -->
  <div id="mainStatus" class="container">
    <!-- Sub Tabs -->
    <div class="tabs">
      <button id="btnTab1" class="active">ğŸ“… å‹Ÿé›†ä½œæˆ</button>
      <button id="btnTab2">ğŸ‘¥ ç©ºãã‚­ãƒ£ãƒ‡ã‚£ç¢ºèª</button>
      <button id="btnTab3">ğŸ“ ç ”ä¿®å¯èƒ½æ—¥è¨­å®š</button>
      <button id="btnTab4">ğŸ“‹ ç ”ä¿®äºˆç´„è€…ä¸€è¦§</button>
    </div>

    <!-- Tab 1: Recruitment Creation -->
    <div id="tab1">
      <form id="createForm" class="loading">
        <h3>ğŸ“ æ–°ã—ã„å‹Ÿé›†ã‚’ä½œæˆ</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center;">
          <label>æ—¥ä»˜: <input type="date" id="bDate" required></label>
          <label>å¿…è¦ã‚­ãƒ£ãƒ‡ã‚£æ•°: <input type="number" id="bSlots" min="1" required style="width:80px"></label>
          <button type="submit">å‹Ÿé›†ä½œæˆ</button>
        </div>
      </form>

      <div class="card loading">
        <h3>ğŸ“Š ç¾åœ¨ã®å‹Ÿé›†çŠ¶æ³</h3>
        <table>
          <thead>
            <tr><th>æ—¥ä»˜</th><th>å¿…è¦äººæ•°</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>æ“ä½œ</th></tr>
          </thead>
          <tbody id="bookBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Tab 2: Availability Calendar -->
    <div id="tab2" class="hidden">
      <div class="calendar-nav">
        <button id="prevMonth">â—€ å‰æœˆ</button>
        <span id="calTitle"></span>
        <button id="nextMonth">æ¬¡æœˆ â–¶</button>
      </div>
      <div class="card loading">
        <h3>ğŸ‘¥ ã‚­ãƒ£ãƒ‡ã‚£ç©ºãçŠ¶æ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
        <table class="calendar" id="calTable"></table>
        <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
          <small><strong>å‡¡ä¾‹:</strong> ğŸŸ¢ 3åä»¥ä¸Š | ğŸŸ¡ 1-2å | ğŸ”´ 0å</small>
        </div>
      </div>
    </div>

    <!-- Tab 3: Training Availability -->
    <div id="tab3" class="hidden">
      <div class="calendar-nav">
        <button id="prevTrainingMonth">â—€ å‰æœˆ</button>
        <span id="trainingCalTitle"></span>
        <button id="nextTrainingMonth">æ¬¡æœˆ â–¶</button>
      </div>
      <div class="card loading">
        <h3>ğŸ“ ç ”ä¿®å¯èƒ½æ—¥è¨­å®š</h3>
        <table class="calendar" id="trainingCalTable"></table>
        <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
          <small><strong>å‡¡ä¾‹:</strong> ğŸ”µ è¨­å®šæ¸ˆã¿ | âšª æœªè¨­å®š | ã‚¯ãƒªãƒƒã‚¯ã§è¨­å®š/è§£é™¤</small>
        </div>
      </div>
    </div>

    <!-- Tab 4: Training Requests -->
    <div id="tab4" class="hidden">
      <div class="card loading">
        <h3>ğŸ“‹ ç ”ä¿®äºˆç´„è€…ä¸€è¦§</h3>
        <div id="trainingRequestsList"></div>
      </div>
    </div>
  </div>

  <!-- Messages Tab -->
  <div id="mainMessages" class="hidden container">
    <div class="card loading">
      <h3>ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
      <div style="display:flex; gap:10px; margin-bottom:20px;">
        <button id="btnInbox" class="active" style="padding:8px 16px; border:none; background:var(--primary-color); color:#fff; border-radius:var(--border-radius); cursor:pointer;">å—ä¿¡ãƒœãƒƒã‚¯ã‚¹</button>
        <button id="btnSent" style="padding:8px 16px; border:none; background:#ecf0f1; color:var(--text-color); border-radius:var(--border-radius); cursor:pointer;">é€ä¿¡æ¸ˆã¿</button>
        <button id="btnNewMessage" style="padding:8px 16px; border:none; background:var(--accent-color); color:#fff; border-radius:var(--border-radius); cursor:pointer;">æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
      </div>
      <div id="messagesList"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient(
      "https://vqjxajzaasuqfgvhvxci.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxanhhanphYXN1cWZndmh2eGNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjIxMzgsImV4cCI6MjA2OTE5ODEzOH0.NmKwgZA1_-TTvMTQt07QRXtIlR-DPOPATVPuQ3QuO54"
    );

    let gid;
    let calMonth = new Date().getMonth(), calYear = new Date().getFullYear();
    let trainingCalMonth = new Date().getMonth(), trainingCalYear = new Date().getFullYear();

    // Loading animation
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('loaded');
        }
      });
    }, observerOptions);

    // Observe all loading elements
    document.querySelectorAll('.loading').forEach(el => {
      observer.observe(el);
    });

    // Authentication check
    supabase.auth.getUser().then(async ({ data }) => {
      if (!data.user) {
        location.href = "/";
        return;
      }
      const role = data.user.user_metadata?.role;
      if (role !== "golf_course") {
        location.href = "dashboard.html";
        return;
      }

      // Get golf course ID
      const { data: golfCourse } = await supabase
        .from('golf_courses')
        .select('gid, name')
        .eq('email', data.user.email)
        .single();

      if (golfCourse) {
        gid = golfCourse.gid;
        document.getElementById('welcome').textContent = `ã‚ˆã†ã“ãã€${golfCourse.name}æ§˜ï¼`;
        loadData();
      }
    });

    // Tab switching
    document.getElementById('btnMainProf').addEventListener('click', () => switchTab('mainProfile'));
    document.getElementById('btnMainStat').addEventListener('click', () => switchTab('mainStatus'));
    document.getElementById('btnMainMsg').addEventListener('click', () => switchTab('mainMessages'));

    document.getElementById('btnTab1').addEventListener('click', () => switchSubTab('tab1'));
    document.getElementById('btnTab2').addEventListener('click', () => switchSubTab('tab2'));
    document.getElementById('btnTab3').addEventListener('click', () => switchSubTab('tab3'));
    document.getElementById('btnTab4').addEventListener('click', () => switchSubTab('tab4'));

    function switchTab(tabName) {
      document.querySelectorAll('.tabs-main button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('[id^="main"]').forEach(div => div.classList.add('hidden'));
      
      event.target.classList.add('active');
      document.getElementById(tabName).classList.remove('hidden');
    }

    function switchSubTab(tabName) {
      document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('[id^="tab"]').forEach(div => div.classList.add('hidden'));
      
      event.target.classList.add('active');
      document.getElementById(tabName).classList.remove('hidden');
    }

    // Load initial data
    function loadData() {
      loadBookings();
      loadCalendar();
      loadTrainingCalendar();
      loadTrainingRequests();
    }

    // Booking management
    async function loadBookings() {
      const { data } = await supabase
        .from('bookings')
        .select('*')
        .eq('gid', gid)
        .order('date', { ascending: true });

      const tbody = document.getElementById('bookBody');
      tbody.innerHTML = '';

      data?.forEach(booking => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${new Date(booking.date).toLocaleDateString('ja-JP')}</td>
          <td>${booking.slots}å</td>
          <td><span class="status-indicator status-active">å‹Ÿé›†ä¸­</span></td>
          <td><button onclick="deleteBooking('${booking.id}')" style="background:#e74c3c; color:white; border:none; padding:0.5rem 1rem; border-radius:var(--border-radius); cursor:pointer;">å‰Šé™¤</button></td>
        `;
      });
    }

    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const date = document.getElementById('bDate').value;
      const slots = document.getElementById('bSlots').value;

      const { error } = await supabase
        .from('bookings')
        .insert([{ gid, date, slots: parseInt(slots) }]);

      if (!error) {
        showMessage('å‹Ÿé›†ã‚’ä½œæˆã—ã¾ã—ãŸï¼', 'success');
        document.getElementById('createForm').reset();
        loadBookings();
      } else {
        showMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
      }
    });

    async function deleteBooking(id) {
      const { error } = await supabase
        .from('bookings')
        .delete()
        .eq('id', id);

      if (!error) {
        showMessage('å‹Ÿé›†ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
        loadBookings();
      } else {
        showMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
      }
    }

    // Calendar management
    function loadCalendar() {
      const calTable = document.getElementById('calTable');
      const calTitle = document.getElementById('calTitle');
      
      calTitle.textContent = `${calYear}å¹´${calMonth + 1}æœˆ`;
      
      // Calendar generation logic here
      // This is a simplified version - you'll need to implement the full calendar logic
      calTable.innerHTML = `
        <thead>
          <tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="cal-green">1</td>
            <td class="cal-yellow">2</td>
            <td class="cal-red">3</td>
            <td class="cal-green">4</td>
            <td class="cal-green">5</td>
            <td class="cal-yellow">6</td>
            <td class="cal-green">7</td>
          </tr>
        </tbody>
      `;
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
      calMonth--;
      if (calMonth < 0) {
        calMonth = 11;
        calYear--;
      }
      loadCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      calMonth++;
      if (calMonth > 11) {
        calMonth = 0;
        calYear++;
      }
      loadCalendar();
    });

    // Training calendar
    function loadTrainingCalendar() {
      const trainingCalTable = document.getElementById('trainingCalTable');
      const trainingCalTitle = document.getElementById('trainingCalTitle');
      
      trainingCalTitle.textContent = `${trainingCalYear}å¹´${trainingCalMonth + 1}æœˆ`;
      
      // Training calendar generation logic here
      trainingCalTable.innerHTML = `
        <thead>
          <tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="cal-blue">1</td>
            <td>2</td>
            <td class="cal-blue">3</td>
            <td>4</td>
            <td class="cal-blue">5</td>
            <td>6</td>
            <td>7</td>
          </tr>
        </tbody>
      `;
    }

    document.getElementById('prevTrainingMonth').addEventListener('click', () => {
      trainingCalMonth--;
      if (trainingCalMonth < 0) {
        trainingCalMonth = 11;
        trainingCalYear--;
      }
      loadTrainingCalendar();
    });

    document.getElementById('nextTrainingMonth').addEventListener('click', () => {
      trainingCalMonth++;
      if (trainingCalMonth > 11) {
        trainingCalMonth = 0;
        trainingCalYear++;
      }
      loadTrainingCalendar();
    });

    // Training requests
    async function loadTrainingRequests() {
      const { data } = await supabase
        .from('training_requests')
        .select(`
          *,
          caddies(name, email)
        `)
        .eq('gid', gid);

      const container = document.getElementById('trainingRequestsList');
      container.innerHTML = '';

      if (data?.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--text-light);">ç ”ä¿®äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      data?.forEach(request => {
        const div = document.createElement('div');
        div.className = 'message-item';
        div.innerHTML = `
          <div class="message-header">
            <span class="message-sender">${request.caddies.name}</span>
            <span class="message-date">${new Date(request.created_at).toLocaleDateString('ja-JP')}</span>
          </div>
          <div class="message-content">
            ç ”ä¿®å¸Œæœ›æ—¥: ${new Date(request.training_date).toLocaleDateString('ja-JP')}<br>
            ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${request.message || 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã—'}
          </div>
        `;
        container.appendChild(div);
      });
    }

    // Messages
    document.getElementById('btnInbox').addEventListener('click', () => loadMessages('inbox'));
    document.getElementById('btnSent').addEventListener('click', () => loadMessages('sent'));
    document.getElementById('btnNewMessage').addEventListener('click', () => showNewMessageModal());

    async function loadMessages(type) {
      // Message loading logic here
      const messagesList = document.getElementById('messagesList');
      messagesList.innerHTML = '<p style="text-align: center; color: var(--text-light);">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™</p>';
    }

    function showNewMessageModal() {
      // New message modal logic here
      alert('æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
    }

    // Utility functions
    function showMessage(message, type = 'info') {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      messageDiv.textContent = message;
      
      document.body.insertBefore(messageDiv, document.body.firstChild);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.href = '/';
    });
  </script>
</body>
</html> 