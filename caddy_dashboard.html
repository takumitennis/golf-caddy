<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Caddy Dashboard</title>
  <style>
    :root {
      --primary-color: #2f8f2f;
      --primary-dark: #1e5f1e;
      --primary-light: #4caf50;
      --secondary-color: #ffffff;
      --accent-color: #ff6b35;
      --text-color: #333333;
      --text-light: #666666;
      --bg-light: #f8f9fa;
      --bg-dark: #2c3e50;
      --border-radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.15);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Helvetica Neue", Arial, "Hiragino Sans", "Yu Gothic", "Meiryo", sans-serif;
      background: var(--bg-light);
      color: var(--text-color);
      line-height: 1.6;
    }

    /* Header */
    h1 {
      margin: 0;
      padding: 1.5rem 2rem;
      background: linear-gradient(135deg, var(--bg-dark), #34495e);
      color: #fff;
      font-size: 1.6rem;
      font-weight: 600;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    h1::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
    }

    /* Main Navigation */
    .tabs-main {
      display: flex;
      gap: 0.5rem;
      padding: 0 2rem;
      background: #ecf0f1;
      border-bottom: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .tabs-main button {
      background: #ecf0f1;
      border: none;
      padding: 1rem 1.5rem;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
      color: var(--text-light);
      position: relative;
      overflow: hidden;
    }

    .tabs-main button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .tabs-main button:hover::before {
      left: 100%;
    }

    .tabs-main button.active {
      border-color: var(--primary-color);
      background: #fff;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      color: var(--primary-color);
      font-weight: bold;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }

    .tabs-main button:hover {
      background: #fff;
      transform: translateY(-1px);
    }

    #logoutBtn {
      margin-left: auto;
      background: #e74c3c;
      color: white;
      border-radius: var(--border-radius);
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      transition: var(--transition);
    }

    #logoutBtn:hover {
      background: #c0392b;
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    /* Container */
    .container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Welcome Message */
    #welcome {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      padding: 1.5rem 2rem;
      border-radius: var(--border-radius);
      margin: 1rem 2rem;
      box-shadow: var(--shadow);
      text-align: center;
      font-size: 1.1rem;
      font-weight: 500;
    }

    /* Tab Content */
    .hidden {
      display: none;
    }

    /* Cards */
    .card {
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(0,0,0,0.05);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    .card h3 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.3rem;
      font-weight: 600;
    }

    /* Shift Management */
    #mainShift {
      padding: 2rem;
    }

    #lockInfo {
      background: #f8d7da;
      color: #721c24;
      padding: 1rem;
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
      border: 1px solid #f5c6cb;
      font-weight: 500;
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      background: #fff;
      padding: 1rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .calendar-nav button {
      padding: 0.5rem 1rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
    }

    .calendar-nav button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .calendar-nav span {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-color);
    }

    /* Calendar */
    .calendar {
      background: #fff;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      width: 100%;
      border-collapse: collapse;
    }

    .calendar th, .calendar td {
      width: 14%;
      padding: 1rem 0.5rem;
      text-align: center;
      border: 1px solid #e1e8ed;
      transition: var(--transition);
    }

    .calendar th {
      background: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    .cal-ok {
      background: #ffffff;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .cal-ok::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      transition: var(--transition);
    }

    .cal-ok:hover {
      background: #f8f9fa;
      transform: scale(1.05);
    }

    .cal-ng {
      background: #eeeeee;
      cursor: pointer;
      position: relative;
    }

    .cal-ng::before {
      content: 'âŒ';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px;
      color: #dc3545;
    }

    .cal-ng:hover {
      background: #f8f9fa;
      transform: scale(1.05);
    }

    .locked {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .locked:hover {
      transform: none !important;
    }

    /* Confirm Button */
    #confirmShiftBtn {
      margin-top: 1rem;
      padding: 1rem 2rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      font-size: 1rem;
    }

    #confirmShiftBtn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    #confirmShiftBtn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }

    /* Messages */
    .message-item {
      background: #f8f9fa;
      border-radius: var(--border-radius);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary-color);
      transition: var(--transition);
    }

    .message-item:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .message-sender {
      font-weight: 600;
      color: var(--primary-color);
    }

    .message-date {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .message-content {
      color: var(--text-color);
      line-height: 1.5;
    }

    /* Message Buttons */
    .message-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .message-buttons button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .message-buttons button.active {
      background: var(--primary-color);
      color: white;
    }

    .message-buttons button:not(.active) {
      background: #ecf0f1;
      color: var(--text-color);
    }

    .message-buttons button:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 500px;
      box-shadow: var(--shadow-hover);
    }

    .modal h3 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
    }

    .modal label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-color);
    }

    .modal select,
    .modal input,
    .modal textarea {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 2px solid #e1e8ed;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    .modal select:focus,
    .modal input:focus,
    .modal textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(47, 143, 47, 0.1);
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }

    .modal-buttons button {
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .modal-buttons button.cancel {
      background: #f0f0f0;
      color: var(--text-color);
      border: 1px solid #ccc;
    }

    .modal-buttons button.send {
      background: var(--primary-color);
      color: white;
      border: none;
    }

    .modal-buttons button:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    /* Status and History */
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .status-card {
      background: #fff;
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
      transition: var(--transition);
    }

    .status-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .status-number {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .status-label {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .tabs-main {
        flex-direction: column;
        padding: 1rem;
      }

      .tabs-main button {
        width: 100%;
        text-align: center;
        border-radius: var(--border-radius);
        margin-bottom: 0.5rem;
      }

      .tabs-main button.active {
        border-radius: var(--border-radius);
      }

      #mainShift {
        padding: 1rem;
      }

      .calendar-nav {
        flex-direction: column;
        gap: 0.5rem;
      }

      .calendar th, .calendar td {
        padding: 0.5rem 0.25rem;
        font-size: 0.9rem;
      }

      .message-buttons {
        flex-direction: column;
      }

      .modal-content {
        width: 95%;
        padding: 1.5rem;
      }

      .modal-buttons {
        flex-direction: column;
      }

      .status-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Loading Animation */
    .loading {
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
    }

    .loading.loaded {
      opacity: 1;
      transform: translateY(0);
    }

    /* Success/Error Messages */
    .message {
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .message.info {
      background: #cce5ff;
      color: #004085;
      border: 1px solid #b8daff;
    }
  </style>
</head>
<body>
  <h1>ğŸŒï¸ ã‚­ãƒ£ãƒ‡ã‚£ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
  <div class="tabs-main">
    <button id="btnMainProf" class="active">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
    <button id="btnMainShift">ã‚·ãƒ•ãƒˆ</button>
    <button id="btnMainStat">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</button>
    <button id="btnMainHist">å±¥æ­´</button>
    <button id="btnMainMsg">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
    <button id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>
  <div id="welcome" class="loading"></div>
  
  <!-- Profile Tab -->
  <div id="mainProfile" class="container">
    <div class="card loading">
      <h3>ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h3>
      <div id="profileContent"></div>
    </div>
  </div>

  <!-- Shift Tab -->
  <div id="mainShift" class="hidden">
    <div id="lockInfo" class="loading"></div>
    <div class="calendar-nav">
      <button id="prevMonth">â—€ å‰æœˆ</button>
      <span id="calTitle"></span>
      <button id="nextMonth">æ¬¡æœˆ â–¶</button>
    </div>
    <div class="card loading">
      <h3>ğŸ“… ã‚·ãƒ•ãƒˆç®¡ç†</h3>
      <table class="calendar" id="calTable"></table>
      <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
        <small><strong>å‡¡ä¾‹:</strong> â—‹ = ç©ºãã‚ã‚Š / âŒ = ç©ºããªã—ï¼ˆã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã§åˆ‡æ›¿ãƒ»ç·¨é›†ç· åˆ‡ã¯å‰æœˆ15æ—¥ï¼‰</small>
      </div>
      <button id="confirmShiftBtn">ã‚·ãƒ•ãƒˆã‚’ç¢ºå®šã™ã‚‹</button>
    </div>
  </div>

  <!-- Status Tab -->
  <div id="mainStatus" class="hidden container">
    <div class="card loading">
      <h3>ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
      <div class="status-grid">
        <div class="status-card">
          <div class="status-number" id="totalShifts">0</div>
          <div class="status-label">ä»Šæœˆã®å‹¤å‹™å›æ•°</div>
        </div>
        <div class="status-card">
          <div class="status-number" id="totalHours">0</div>
          <div class="status-label">ä»Šæœˆã®å‹¤å‹™æ™‚é–“</div>
        </div>
        <div class="status-card">
          <div class="status-number" id="avgRating">0.0</div>
          <div class="status-label">å¹³å‡è©•ä¾¡</div>
        </div>
        <div class="status-card">
          <div class="status-number" id="activeBookings">0</div>
          <div class="status-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªäºˆç´„</div>
        </div>
      </div>
    </div>
  </div>

  <!-- History Tab -->
  <div id="mainHistory" class="hidden container">
    <div class="card loading">
      <h3>ğŸ“ˆ å‹¤å‹™å±¥æ­´</h3>
      <div id="historyContent">
        <p style="text-align: center; color: var(--text-light);">å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã¯é–‹ç™ºä¸­ã§ã™</p>
      </div>
    </div>
  </div>

  <!-- Messages Tab -->
  <div id="mainMessages" class="hidden container">
    <div class="card loading">
      <h3>ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
      <div class="message-buttons">
        <button id="btnInbox" class="active">å—ä¿¡ãƒœãƒƒã‚¯ã‚¹</button>
        <button id="btnSent">é€ä¿¡æ¸ˆã¿</button>
        <button id="btnNewMessage">æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
      </div>
      <div id="messagesList"></div>
    </div>
  </div>
  
  <!-- New Message Modal -->
  <div id="newMessageModal" class="modal">
    <div class="modal-content">
      <h3>âœ‰ï¸ æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
      <div>
        <label>é€ä¿¡å…ˆ:</label>
        <select id="messageReceiver">
          <option value="">é€ä¿¡å…ˆã‚’é¸æŠ</option>
        </select>
      </div>
      <div>
        <label>ä»¶å:</label>
        <input type="text" id="messageSubject">
      </div>
      <div>
        <label>å†…å®¹:</label>
        <textarea id="messageContent" rows="5"></textarea>
      </div>
      <div class="modal-buttons">
        <button id="cancelMessage" class="cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="sendMessage" class="send">é€ä¿¡</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient(
      "https://vqjxajzaasuqfgvhvxci.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxanhhanphYXN1cWZndmh2eGNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjIxMzgsImV4cCI6MjA2OTE5ODEzOH0.NmKwgZA1_-TTvMTQt07QRXtIlR-DPOPATVPuQ3QuO54"
    );

    let cid;
    let calMonth = new Date().getMonth(), calYear = new Date().getFullYear();
    const calTable = document.getElementById('calTable');
    const lockInfo = document.getElementById('lockInfo');

    // Loading animation
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('loaded');
        }
      });
    }, observerOptions);

    // Observe all loading elements
    document.querySelectorAll('.loading').forEach(el => {
      observer.observe(el);
    });

    // Authentication check
    supabase.auth.getUser().then(async ({ data }) => {
      if (!data.user) {
        location.href = "/";
        return;
      }
      const role = data.user.user_metadata?.role;
      if (role !== "caddy") {
        location.href = "dashboard.html";
        return;
      }

      // Get caddy ID
      const { data: caddy } = await supabase
        .from('caddies')
        .select('cid, name')
        .eq('email', data.user.email)
        .single();

      if (caddy) {
        cid = caddy.cid;
        document.getElementById('welcome').textContent = `ã‚ˆã†ã“ãã€${caddy.name}æ§˜ï¼`;
        loadData();
      }
    });

    // Tab switching
    document.getElementById('btnMainProf').addEventListener('click', () => switchTab('mainProfile'));
    document.getElementById('btnMainShift').addEventListener('click', () => switchTab('mainShift'));
    document.getElementById('btnMainStat').addEventListener('click', () => switchTab('mainStatus'));
    document.getElementById('btnMainHist').addEventListener('click', () => switchTab('mainHistory'));
    document.getElementById('btnMainMsg').addEventListener('click', () => switchTab('mainMessages'));

    function switchTab(tabName) {
      document.querySelectorAll('.tabs-main button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('[id^="main"]').forEach(div => div.classList.add('hidden'));
      
      event.target.classList.add('active');
      document.getElementById(tabName).classList.remove('hidden');
    }

    // Load initial data
    function loadData() {
      loadProfile();
      loadCalendar();
      loadStatus();
    }

    // Profile management
    async function loadProfile() {
      const { data } = await supabase
        .from('caddies')
        .select('*')
        .eq('cid', cid)
        .single();

      if (data) {
        const profileContent = document.getElementById('profileContent');
        profileContent.innerHTML = `
          <div style="display: grid; gap: 1rem;">
            <div><strong>åå‰:</strong> ${data.name}</div>
            <div><strong>ãƒ¡ãƒ¼ãƒ«:</strong> ${data.email}</div>
            <div><strong>é›»è©±ç•ªå·:</strong> ${data.phone || 'æœªè¨­å®š'}</div>
            <div><strong>çµŒé¨“å¹´æ•°:</strong> ${data.experience_years || 0}å¹´</div>
            <div><strong>ç™»éŒ²æ—¥:</strong> ${new Date(data.created_at).toLocaleDateString('ja-JP')}</div>
          </div>
        `;
      }
    }

    // Calendar management
    function loadCalendar() {
      const calTitle = document.getElementById('calTitle');
      calTitle.textContent = `${calYear}å¹´${calMonth + 1}æœˆ`;
      
      // Check if editing is locked
      const today = new Date();
      const lockDate = new Date(calYear, calMonth - 1, 15);
      const isLocked = today > lockDate;
      
      if (isLocked) {
        lockInfo.textContent = `âš ï¸ ${calYear}å¹´${calMonth}æœˆã®ã‚·ãƒ•ãƒˆç·¨é›†ã¯ç· ã‚åˆ‡ã‚‰ã‚Œã¦ã„ã¾ã™`;
        lockInfo.style.display = 'block';
      } else {
        lockInfo.style.display = 'none';
      }

      // Generate calendar
      generateCalendar();
    }

    function generateCalendar() {
      const firstDay = new Date(calYear, calMonth, 1);
      const lastDay = new Date(calYear, calMonth + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());

      let html = `
        <thead>
          <tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr>
        </thead>
        <tbody>
      `;

      for (let week = 0; week < 6; week++) {
        html += '<tr>';
        for (let day = 0; day < 7; day++) {
          const currentDate = new Date(startDate);
          currentDate.setDate(startDate.getDate() + week * 7 + day);
          
          const isCurrentMonth = currentDate.getMonth() === calMonth;
          const dayNumber = currentDate.getDate();
          const isToday = currentDate.toDateString() === new Date().toDateString();
          
          let cellClass = '';
          let cellContent = dayNumber;
          
          if (!isCurrentMonth) {
            cellClass = 'locked';
            cellContent = '';
          } else if (isToday) {
            cellClass = 'cal-ok';
            cellContent = `<strong>${dayNumber}</strong>`;
          } else {
            cellClass = 'cal-ok';
          }
          
          html += `<td class="${cellClass}" onclick="toggleAvailability(${dayNumber})">${cellContent}</td>`;
        }
        html += '</tr>';
      }
      
      html += '</tbody>';
      calTable.innerHTML = html;
    }

    function toggleAvailability(day) {
      // Toggle availability logic here
      console.log(`Toggle availability for day ${day}`);
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
      calMonth--;
      if (calMonth < 0) {
        calMonth = 11;
        calYear--;
      }
      loadCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      calMonth++;
      if (calMonth > 11) {
        calMonth = 0;
        calYear++;
      }
      loadCalendar();
    });

    document.getElementById('confirmShiftBtn').addEventListener('click', () => {
      showMessage('ã‚·ãƒ•ãƒˆã‚’ç¢ºå®šã—ã¾ã—ãŸï¼', 'success');
    });

    // Status management
    async function loadStatus() {
      // Load status data
      document.getElementById('totalShifts').textContent = '12';
      document.getElementById('totalHours').textContent = '96';
      document.getElementById('avgRating').textContent = '4.8';
      document.getElementById('activeBookings').textContent = '3';
    }

    // Messages
    document.getElementById('btnInbox').addEventListener('click', () => loadMessages('inbox'));
    document.getElementById('btnSent').addEventListener('click', () => loadMessages('sent'));
    document.getElementById('btnNewMessage').addEventListener('click', () => showNewMessageModal());

    function loadMessages(type) {
      const messagesList = document.getElementById('messagesList');
      
      if (type === 'inbox') {
        messagesList.innerHTML = `
          <div class="message-item">
            <div class="message-header">
              <span class="message-sender">ABCã‚´ãƒ«ãƒ•å ´</span>
              <span class="message-date">2024/01/15</span>
            </div>
            <div class="message-content">
              æ¥é€±ã®ã‚·ãƒ•ãƒˆã«ã¤ã„ã¦ç¢ºèªã•ã›ã¦ã„ãŸã ããŸã„ã®ã§ã™ãŒã€ã”éƒ½åˆã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ
            </div>
          </div>
          <div class="message-item">
            <div class="message-header">
              <span class="message-sender">XYZã‚´ãƒ«ãƒ•ã‚¯ãƒ©ãƒ–</span>
              <span class="message-date">2024/01/14</span>
            </div>
            <div class="message-content">
              ç ”ä¿®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è©³ç´°ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚ã”ç¢ºèªãã ã•ã„ã€‚
            </div>
          </div>
        `;
      } else {
        messagesList.innerHTML = '<p style="text-align: center; color: var(--text-light);">é€ä¿¡æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
      }
    }

    function showNewMessageModal() {
      document.getElementById('newMessageModal').style.display = 'flex';
    }

    document.getElementById('cancelMessage').addEventListener('click', () => {
      document.getElementById('newMessageModal').style.display = 'none';
    });

    document.getElementById('sendMessage').addEventListener('click', () => {
      const receiver = document.getElementById('messageReceiver').value;
      const subject = document.getElementById('messageSubject').value;
      const content = document.getElementById('messageContent').value;
      
      if (!receiver || !subject || !content) {
        showMessage('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      showMessage('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼', 'success');
      document.getElementById('newMessageModal').style.display = 'none';
      document.getElementById('messageReceiver').value = '';
      document.getElementById('messageSubject').value = '';
      document.getElementById('messageContent').value = '';
    });

    // Utility functions
    function showMessage(message, type = 'info') {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      messageDiv.textContent = message;
      
      document.body.insertBefore(messageDiv, document.body.firstChild);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.href = '/';
    });
  </script>
</body>
</html> 